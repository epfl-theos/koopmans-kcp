<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">

<!--Converted with LaTeX2HTML 2002-2-1 (1.71)
original version by:  Nikos Drakos, CBLU, University of Leeds
* revised and updated by:  Marcus Hennecke, Ross Moore, Herb Swan
* with significant contributions from:
  Jens Lippmann, Marek Rouchal, Martin Wilck and others -->
<HTML>
<HEAD>
<TITLE>5.5 Conjugate Gradient </TITLE>
<META NAME="description" CONTENT="5.5 Conjugate Gradient ">
<META NAME="keywords" CONTENT="user_guide">
<META NAME="resource-type" CONTENT="document">
<META NAME="distribution" CONTENT="global">

<META NAME="Generator" CONTENT="LaTeX2HTML v2002-2-1">
<META HTTP-EQUIV="Content-Style-Type" CONTENT="text/css">

<LINK REL="STYLESHEET" HREF="user_guide.css">

<LINK REL="next" HREF="node28.html">
<LINK REL="previous" HREF="node26.html">
<LINK REL="up" HREF="node22.html">
<LINK REL="next" HREF="node28.html">
</HEAD>

<BODY >
<!--Navigation Panel-->
<A NAME="tex2html681"
  HREF="node28.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next" SRC="next.gif"></A> 
<A NAME="tex2html677"
  HREF="node22.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up" SRC="up.gif"></A> 
<A NAME="tex2html671"
  HREF="node26.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous" SRC="prev.gif"></A> 
<A NAME="tex2html679"
  HREF="node1.html">
<IMG WIDTH="65" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="contents" SRC="contents.gif"></A>  
<BR>
<B> Next:</B> <A NAME="tex2html682"
  HREF="node28.html">5.6 About nr1b, nr2b,</A>
<B> Up:</B> <A NAME="tex2html678"
  HREF="node22.html">5 Using CP</A>
<B> Previous:</B> <A NAME="tex2html672"
  HREF="node26.html">5.4 Variable-cell MD</A>
   <B>  <A NAME="tex2html680"
  HREF="node1.html">Contents</A></B> 
<BR>
<BR>
<!--End of Navigation Panel-->
<!--Table of Child-Links-->
<A NAME="CHILD_LINKS"><STRONG>Subsections</STRONG></A>

<UL>
<LI><UL>
<LI><A NAME="tex2html683"
  HREF="node27.html#SECTION00065010000000000000">5.5.0.1  ensemble-DFT </A>
</UL></UL>
<!--End of Table of Child-Links-->
<HR>

<H2><A NAME="SECTION00065000000000000000">
5.5  Conjugate Gradient </A>
</H2>

<P>
This page is under construction.

<P>

<H4><A NAME="SECTION00065010000000000000">
5.5.0.1  ensemble-DFT </A>
</H4>

<P>
The ensemble-DFT (eDFT) is a robust method to simulate the metals in the 
framework of ''ab-initio'' molecular dynamics. It was introduced in 1997 
by Marzari et al.

<P>
The specific subroutines for the eDFT are in ensemble_dft.f90 where you 
define all the quantities of interest. The subroutine inner_loop_cold.f90
called by cg_sub.f90, control the inner loop, and so the minimization of 
the free energy <I>A</I>
<tex2html_verbatim_mark> with respect to the occupation matrix.

<P>
To select a eDFT calculations, the user has to choice:
<PRE>
            calculation = 'cp'
            occupations= 'ensemble' 
            tcg = .true.
            passop= 0.3
            maxiter = 250
</PRE>
to use the CG procedure. In the eDFT it is also the outer loop, where thei
energy is minimized with respect to the wavefunction keeping fixed the 
occupation matrix. While the specific parameters for the inner loop.
Since eDFT was born to treat metals, keep in mind that we want to describe 
the broadening of the occupations around the Fermi energy.
Below the new parameters in the electrons list, are listed.

<UL>
<LI>smearing: used to select the occupation distribution;
there are two options: Fermi-Dirac smearing='fd', cold-smearing
smearing='cs' (recommanded) 
</LI>
<LI>degauss: is the electronic temperature; it controls the broadening
of the occupation numbers around the Fermi energy. 
</LI>
<LI>ninner: is the number of iterative cycles in the inner loop, 
done to minimize the free energy <I>A</I>
<tex2html_verbatim_mark> with respect the occupation numbers.
The typical range is 2-8.
</LI>
<LI>conv_thr: is the threshold value to stop the search of the 'minimum' 
free energy.
</LI>
<LI>niter_cold_restart: controls the frequency at which a full iterative
inner cycle is done. It is in the range 1-ninner. It is a trick to speed up 
the calculation.
</LI>
<LI>lambda_cold: is the length step along the search line for the best 
value for <I>A</I>
<tex2html_verbatim_mark>, when the iterative cycle is not performed. The value is close 
to 0.03, smaller for large and complicated metallic systems.
</LI>
</UL>
<EM>NOTE:</EM> degauss is in Hartree, while in PWscf is in Ry (!!!). 
The tyPical range is 0.01-0.02 Ha.

<P>
The input for an Al surface is:
<PRE>
            &amp;CONTROL
             calculation = 'cp',
             restart_mode = 'from_scratch',
             nstep  = 10,
             iprint = 5,
             isave  = 5,
             dt    = 125.0d0,
             prefix = 'Aluminum_surface',
             pseudo_dir = '~/UPF/',
             outdir = '/scratch/'
             ndr=50
             ndw=51
            /
            &amp;SYSTEM
             ibrav=  14,
             celldm(1)= 21.694d0, celldm(2)= 1.00D0, celldm(3)= 2.121D0,
             celldm(4)= 0.0d0,   celldm(5)= 0.0d0, celldm(6)= 0.0d0,
             nat= 96,
             ntyp= 1,
             nspin=1,
             ecutwfc= 15,
             nbnd=160,
             nelec=291,
             xc_type = 'pbe'
             occupations= 'ensemble',
             smearing='cs',
             degauss=0.018,
            /
            &amp;ELECTRONS
             orthogonalization = 'Gram-Schmidt',
             startingwfc = 'random',
             ampre = 0.02,
             tcg = .true.,
             passop= 0.3,
             maxiter = 250,
             emass_cutoff = 3.00,
             conv_thr=1.d-6
             n_inner = 2,
             lambda_cold = 0.03,
             niter_cold_restart = 2,
            /
            &amp;IONS
             ion_dynamics  = 'verlet',
             ion_temperature = 'nose'
             fnosep = 4.0d0,
             tempw = 500.d0
            /
            ATOMIC_SPECIES
             Al 26.89 Al.pbe.UPF
</PRE>
<EM>NOTA1</EM>  remember that the time step is to integrate the ionic dynamics,
so you can choose something in the range of 1-5 fs. 
<BR><EM>NOTA2</EM> with eDFT you are simulating metals or systems for which the 
occupation number is also fractional, so the number of band, nbnd, has to 
be chosen such as to have some empty states. As a rule of thumb, start
with an initial occupation number of about 1.6-1.8 (the more bands you 
considera, the more the calculation is accurate, but it also takes longer.
The CPU time scales almost linearly with the number of bands.) 
<BR><EM>NOTA3</EM> the parameter emass_cutoff is used during the preconditioning 
and it has a completely different meaning with respect to plain CP. 
It ranges between 4 and 7.

<P>
All the other parameters have the same meaning in the usual CP input, 
and they are discussed above.

<P>
<HR>
<!--Navigation Panel-->
<A NAME="tex2html681"
  HREF="node28.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next" SRC="next.gif"></A> 
<A NAME="tex2html677"
  HREF="node22.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up" SRC="up.gif"></A> 
<A NAME="tex2html671"
  HREF="node26.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous" SRC="prev.gif"></A> 
<A NAME="tex2html679"
  HREF="node1.html">
<IMG WIDTH="65" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="contents" SRC="contents.gif"></A>  
<BR>
<B> Next:</B> <A NAME="tex2html682"
  HREF="node28.html">5.6 About nr1b, nr2b,</A>
<B> Up:</B> <A NAME="tex2html678"
  HREF="node22.html">5 Using CP</A>
<B> Previous:</B> <A NAME="tex2html672"
  HREF="node26.html">5.4 Variable-cell MD</A>
   <B>  <A NAME="tex2html680"
  HREF="node1.html">Contents</A></B> 
<!--End of Navigation Panel-->
<ADDRESS>
Paolo Giannozzi
2009-07-19
</ADDRESS>
</BODY>
</HTML>

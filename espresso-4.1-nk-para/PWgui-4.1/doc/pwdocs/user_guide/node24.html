<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">

<!--Converted with LaTeX2HTML 2002-2-1 (1.71)
original version by:  Nikos Drakos, CBLU, University of Leeds
* revised and updated by:  Marcus Hennecke, Ross Moore, Herb Swan
* with significant contributions from:
  Jens Lippmann, Marek Rouchal, Martin Wilck and others -->
<HTML>
<HEAD>
<TITLE>5.2 Relax the system</TITLE>
<META NAME="description" CONTENT="5.2 Relax the system">
<META NAME="keywords" CONTENT="user_guide">
<META NAME="resource-type" CONTENT="document">
<META NAME="distribution" CONTENT="global">

<META NAME="Generator" CONTENT="LaTeX2HTML v2002-2-1">
<META HTTP-EQUIV="Content-Style-Type" CONTENT="text/css">

<LINK REL="STYLESHEET" HREF="user_guide.css">

<LINK REL="next" HREF="node25.html">
<LINK REL="previous" HREF="node23.html">
<LINK REL="up" HREF="node22.html">
<LINK REL="next" HREF="node25.html">
</HEAD>

<BODY >
<!--Navigation Panel-->
<A NAME="tex2html642"
  HREF="node25.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next" SRC="next.gif"></A> 
<A NAME="tex2html638"
  HREF="node22.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up" SRC="up.gif"></A> 
<A NAME="tex2html632"
  HREF="node23.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous" SRC="prev.gif"></A> 
<A NAME="tex2html640"
  HREF="node1.html">
<IMG WIDTH="65" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="contents" SRC="contents.gif"></A>  
<BR>
<B> Next:</B> <A NAME="tex2html643"
  HREF="node25.html">5.3 CP dynamics</A>
<B> Up:</B> <A NAME="tex2html639"
  HREF="node22.html">5 Using CP</A>
<B> Previous:</B> <A NAME="tex2html633"
  HREF="node23.html">5.1 Reaching the electronic</A>
   <B>  <A NAME="tex2html641"
  HREF="node1.html">Contents</A></B> 
<BR>
<BR>
<!--End of Navigation Panel-->

<H2><A NAME="SECTION00062000000000000000">
5.2 Relax the system</A>
</H2>

<P>
Once your system is in the GS, depending on how you have prepared the starting
atomic configuration:

<UL>
<LI>if you have set the atomic positions "by hand" and/or from a classical code, 
check the forces on atoms, and if they are large (<!-- MATH
 $\sim 0.1 \div 1.0$
 -->
<IMG
 WIDTH="20" HEIGHT="19" ALIGN="BOTTOM" BORDER="0"
 SRC="img7.gif"
 ALT="$ \sim$"> 0.1 &#247; 1.0
<tex2html_verbatim_mark>
atomic units), you should perform an ionic minimization, otherwise the
system could break up during the dynamics.
</LI>
<LI>if you have taken the positions from a previous run or a previous ab-initio 
simulation, check the forces, and if they are too small (<!-- MATH
 $\sim 10^{-4}$
 -->
<IMG
 WIDTH="20" HEIGHT="19" ALIGN="BOTTOM" BORDER="0"
 SRC="img7.gif"
 ALT="$ \sim$"> 10<SUP>-4</SUP>
<tex2html_verbatim_mark> 
atomic units), this means that atoms are already in equilibrium positions 
and, even if left free, they will not move. Then you need to randomize 
positions a little bit (see below).
</LI>
</UL>

<P>
1.) Minimize ionic positions.

<P>
As we pointed out in 4) if the interatomic forces are too high, 
the system could "explode" if we switch on the ionic dynamics. 
To avoid that we need to relax the system. Again there are 
different strategies to relax the system, but the most used 
are again steepest descent or damped dynamics for ions and electrons. 
You could also mix electronic and ionic minimization scheme freely, 
i.e. ions in steepest and electron in damping or vice versa.

<P>
(a) suppose we want to perform a steepest for ions. Then we should specify 
the following section for ions:
<PRE> 
         &amp;ions
           ion_dynamics = 'sd'
         /
</PRE> 
Change also the ionic masses to accelerate the minimization:
<PRE> 
         ATOMIC_SPECIES
          C 2.0d0 c_blyp_gia.pp
          H 2.00d0 h.ps
</PRE> 
while leaving other input parameters unchanged.
<EM>Note</EM> that if the forces are really high (&gt; 1.0
<tex2html_verbatim_mark> atomic units), you
should always use steepest descent for the first (<IMG
 WIDTH="20" HEIGHT="19" ALIGN="BOTTOM" BORDER="0"
 SRC="img7.gif"
 ALT="$ \sim$"> 100
<tex2html_verbatim_mark>
relaxation steps. 

<P>
(b) as the system approaches the equilibrium positions, the steepest 
descent scheme slows down, so is better to switch to damped dynamics:
<PRE> 
         &amp;ions
           ion_dynamics = 'damp',
           ion_damping = 0.2,
           ion_velocities = 'zero'
         /
</PRE>
A typical value of ion damping between 0.05 is good for many systems. 
It is also better to specify to restart with zero ionic and electronic 
velocities, since we have changed the masses.

<P>
Change further the ionic masses to accelerate the minimization:
<PRE> 
           ATOMIC_SPECIES
           C 0.1d0 c_blyp_gia.pp
           H 0.1d0 h.ps
</PRE>

<P>
(c) when the system is really close to the equilibrium, the damped dynamics 
slow down too, especially because, since we are moving electron and ions 
together, the ionic forces are not properly correct, then it is often better 
to perform a ionic step every N electronic steps, or to move ions only when
electron are in their GS (within the chosen threshold).

<P>
This can be specified by adding, in the ionic section, the ion_nstepe
parameter, then the ionic input section become as follows:
<PRE> 
         &amp;ions
           ion_dynamics = 'damp',
           ion_damping = 0.2,
           ion_velocities = 'zero',
           ion_nstepe = 10
         /
</PRE>
Then we specify in the control input section:
<PRE> 
           etot_conv_thr = 1.d-6,
           ekin_conv_thr = 1.d-5,
           forc_conv_thr = 1.d-3
</PRE>
As a result, the code checks every 10 electronic steps whether
the electronic system satisfies the two thresholds etot_conv_thr,
ekin_conv_thr: if it does, the ions are advanced by one step.
The process thus continues until the forces become smaller than
forc_conv_thr.

<P>
<EM>Note</EM> that to fully relax the system you need many run, and different 
strategies, that you shold mix and change in order to speed-up the convergence.
The process is not automatic, but is strongly based on experience, and trial 
and error.

<P>
Remember also that the convergence to the equilibrium positions depends on 
the energy threshold for the electronic GS, in fact correct forces (required
to move ions toward the minimum) are obtained only when electrons are in their 
GS. Then a small threshold on forces could not be satisfied, if you do not 
require an even smaller threshold on total energy.

<P>
2. Randomization of positions.

<P>
If you have relaxed the system or if the starting system is already in
the equilibrium positions, then you need to move ions from the equilibrium 
positions, otherwise they will nott move in a dynamics simulation.
After the randomization you should bring electrons on the GS again,
in order to start a dynamic with the correct forces and with electrons 
in the GS. Then you should switch off the ionic dynamics and activate 
the randomization for each species, specifying the amplitude of the 
randomization itself. This could be done with the following ionic input 
section:
<PRE>
          &amp;ions
            ion_dynamics = 'none',
            tranp(1) = .TRUE.,
            tranp(2) = .TRUE.,
            amprp(1) = 0.01
            amprp(2) = 0.01
          /
</PRE>
In this way a random displacement (of max 0.01 a.u.) is added to atoms of 
species 1 and 2. All other input parameters could remain the same.
Note that the difference in the total energy (etot) between relaxed and
randomized positions can be used to estimate the temperature that will
be reached by the system. In fact, starting with zero ionic velocities,
all the diffrence is potential energy, but in a dynamics simulation, the
energy will be equipartitioned between kinetic and potential, then to
estimate the temperature take the difference in energy (de), convert it
in Kelvins, divide for the number of atoms and multiply by 2/3.
Randomization could be useful also while we are relaxing the system,
especially when we suspect that the ions are in a local minimum or in
an energy plateau.

<P>
<HR>
<!--Navigation Panel-->
<A NAME="tex2html642"
  HREF="node25.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next" SRC="next.gif"></A> 
<A NAME="tex2html638"
  HREF="node22.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up" SRC="up.gif"></A> 
<A NAME="tex2html632"
  HREF="node23.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous" SRC="prev.gif"></A> 
<A NAME="tex2html640"
  HREF="node1.html">
<IMG WIDTH="65" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="contents" SRC="contents.gif"></A>  
<BR>
<B> Next:</B> <A NAME="tex2html643"
  HREF="node25.html">5.3 CP dynamics</A>
<B> Up:</B> <A NAME="tex2html639"
  HREF="node22.html">5 Using CP</A>
<B> Previous:</B> <A NAME="tex2html633"
  HREF="node23.html">5.1 Reaching the electronic</A>
   <B>  <A NAME="tex2html641"
  HREF="node1.html">Contents</A></B> 
<!--End of Navigation Panel-->
<ADDRESS>
Paolo Giannozzi
2009-07-19
</ADDRESS>
</BODY>
</HTML>

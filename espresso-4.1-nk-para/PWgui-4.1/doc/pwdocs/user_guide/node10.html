<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">

<!--Converted with LaTeX2HTML 2002-2-1 (1.71)
original version by:  Nikos Drakos, CBLU, University of Leeds
* revised and updated by:  Marcus Hennecke, Ross Moore, Herb Swan
* with significant contributions from:
  Jens Lippmann, Marek Rouchal, Martin Wilck and others -->
<HTML>
<HEAD>
<TITLE>2.3 configure</TITLE>
<META NAME="description" CONTENT="2.3 configure">
<META NAME="keywords" CONTENT="user_guide">
<META NAME="resource-type" CONTENT="document">
<META NAME="distribution" CONTENT="global">

<META NAME="Generator" CONTENT="LaTeX2HTML v2002-2-1">
<META HTTP-EQUIV="Content-Style-Type" CONTENT="text/css">

<LINK REL="STYLESHEET" HREF="user_guide.css">

<LINK REL="next" HREF="node11.html">
<LINK REL="previous" HREF="node9.html">
<LINK REL="up" HREF="node7.html">
<LINK REL="next" HREF="node11.html">
</HEAD>

<BODY >
<!--Navigation Panel-->
<A NAME="tex2html398"
  HREF="node11.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next" SRC="next.gif"></A> 
<A NAME="tex2html394"
  HREF="node7.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up" SRC="up.gif"></A> 
<A NAME="tex2html388"
  HREF="node9.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous" SRC="prev.gif"></A> 
<A NAME="tex2html396"
  HREF="node1.html">
<IMG WIDTH="65" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="contents" SRC="contents.gif"></A>  
<BR>
<B> Next:</B> <A NAME="tex2html399"
  HREF="node11.html">2.4 Compilation</A>
<B> Up:</B> <A NAME="tex2html395"
  HREF="node7.html">2 Installing QUANTUM ESPRESSO</A>
<B> Previous:</B> <A NAME="tex2html389"
  HREF="node9.html">2.2 Installation</A>
   <B>  <A NAME="tex2html397"
  HREF="node1.html">Contents</A></B> 
<BR>
<BR>
<!--End of Navigation Panel-->
<!--Table of Child-Links-->
<A NAME="CHILD_LINKS"><STRONG>Subsections</STRONG></A>

<UL>
<LI><A NAME="tex2html400"
  HREF="node10.html#SECTION00033100000000000000">2.3.1 Libraries</A>
<UL>
<LI><A NAME="tex2html401"
  HREF="node10.html#SECTION00033110000000000000">2.3.1.1 BLAS and LAPACK</A>
<LI><A NAME="tex2html402"
  HREF="node10.html#SECTION00033120000000000000">2.3.1.2 FFT</A>
<LI><A NAME="tex2html403"
  HREF="node10.html#SECTION00033130000000000000">2.3.1.3 MPI libraries</A>
<LI><A NAME="tex2html404"
  HREF="node10.html#SECTION00033140000000000000">2.3.1.4 Other libraries</A>
</UL>
<BR>
<LI><A NAME="tex2html405"
  HREF="node10.html#SECTION00033200000000000000">2.3.2 Manual configuration</A>
</UL>
<!--End of Table of Child-Links-->
<HR>

<H2><A NAME="SECTION00033000000000000000">
2.3 <TT>configure</TT></A>
</H2>

<P>
To install the Q<SMALL>UANTUM </SMALL>ESPRESSO source package, run the <TT>configure</TT>
script. It will (try to) detect compilers and libraries available on
your machine, and set up things accordingly. Presently it is expected
to work on most Linux 32- and 64-bit PCs (all Intel and AMD CPUs), PC
clusters, IBM SP machines, SGI Origin and Altix, some HP-Compaq Alpha
machines, NEC SX, Cray X1-XD-XT machines, Mac OS X, 
MS-Windows PCs. It may work with
some assistance also on other architectures (see below). 

<P>
For cross-compilation, you have to specify the target machine with the
-host option (see below). This feature has not been extensively
tested, but we had at least one successful report (compilation for NEC
SX6 on a PC). 

<P>
Specifically, <TT>configure</TT> generates the following files:
<PRE>
    make.sys:           compilation rules and flags
    configure.msg:      a report of the configuration run
    include/fft_defs.h: defines fortran variable for C pointer
    include/c_defs.h:   defines C to fortran calling convention
                        and a few more things used by C files
</PRE>
<TT>configure.msg</TT> is only used by <TT>configure</TT> to print its final 
report and is not needed for compilation. NOTA BENE: unlike previous
versions, <TT>configure</TT> no longer runs the <TT>makedeps.sh</TT> 
shell script that updates dependencies. If you modify the program 
sources, run <TT>./makedeps.sh</TT> or type <TT>make depend</TT>
to update files <TT>make.depend</TT> in the various subdirectories.

<P>
You should always be able to compile the Q<SMALL>UANTUM </SMALL>ESPRESSO suite
of programs without having to edit any of the generated files. However you
may have to tune <TT>configure</TT> by specifying appropriate environment variables
and/or command-line options. Usually tricky part is to get external
libraries recognized and used: see Sec.<A NAME="Sec:Libraries"></A>for details and hints.

<P>
Environment variables may be set in any of these ways:
<PRE>
     export VARIABLE=value               # sh, bash, ksh
     ./configure
     setenv VARIABLE value               # csh, tcsh
     ./configure
     ./configure VARIABLE=value          # any shell
</PRE>
Some environment variables that are relevant to <TT>configure</TT> are:
<PRE>
     ARCH:         label identifying the machine type (see below)
     F90, F77, CC: names of Fortran 95, Fortran 77, and C compilers
     MPIF90:       name of parallel Fortran 95 compiler (using MPI)
     CPP:          source file preprocessor (defaults to $CC -E)
     LD:           linker (defaults to $MPIF90)
     CFLAGS, FFLAGS, F90FLAGS, CPPFLAGS, LDFLAGS: compilation flags
     LIBDIRS:      extra directories to search for libraries (see below)
</PRE>
For example, the following command line:
<PRE>
     ./configure MPIF90=mpf90 FFLAGS="-O2 -assume byterecl" \
                  CC=gcc CFLAGS=-O3 LDFLAGS=-static
</PRE>
instructs <TT>configure</TT> to use <TT>mpf90</TT> as Fortran 95 compiler 
with flags <TT>-O2 -assume byterecl</TT>, <TT>gcc</TT> as C compiler with 
flags <TT>-O3</TT>, and to link with flag <TT>-static</TT>. 
Note that the value of FFLAGS must be quoted, because it contains
spaces. NOTA BENE: do not pass compiler names with the leading path
included. <TT>F90=f90xyz</TT> is ok, <TT>F90=/path/to/f90xyz</TT> is not. 
Do not use
environmental variables with <TT>configure</TT> unless they are needed! try
<TT>configure</TT> with no options as a first step.

<P>
If your machine type is unknown to configure, you may use the ARCH
variable to suggest an architecture among supported ones. Some large
parallel machines using a front-end (e.g. Cray XT) may need to define
the correct ARCH even if they are apparently recognized, because
<TT>configure</TT> cannot figure out that cross-compilation is needed.
Try the one that
looks more similar to your machine type; you'll probably have to do some
additional tweaking. Currently supported architectures are:
<PRE>
      ia32:   Intel 32-bit machines (x86) running Linux
      ia64:   Intel 64-bit (Itanium) running Linux
      x86_64: Intel and AMD 64-bit running Linux - see note below
      aix:    IBM AIX machines
      mips:   SGI MIPS machines
      alpha:  HP-Compaq alpha machines
      alinux: HP-Compaq alpha running Linux
      sparc:  Sun SPARC machines
      solaris:PC's running SUN-Solaris
      crayx1: Cray X1 machines
      crayxt4: Cray XT4/5 machines
      macppc: Apple PowerPC machines running Mac OS X
      mac686: Apple Intel machines running Mac OS X
      cygwin: MS-Windows PCs with Cygwin
      necsx:  NEC SX-6 and SX-8 machines
      ppc64:  Linux PowerPC machines, 64 bits
      ppc64-mn:as above, with IBM xlf compiler
</PRE>
<EM>Note</EM>: x86_64 replaces amd64 since v.4.1. 
Finally, <TT>configure</TT> recognizes the following command-line options:
<PRE>
--disable-parallel: compile serial code, even if parallel compiler available
--host=target :     specify target machine for cross-compilation.
                    target is a string identifying the architecture you want
                    to compile for; run config.guess on the target machine
--disable-shared:   don't use shared libraries: generate static executables
--enable-shared:    use shared libraries
</PRE>
The latter two options actually work only in a few specific cases.
If you want to modify the <TT>configure</TT> script (advanced users only!), 
see the Developer Manual.  You will need GNU Autoconf 
(http://www.gnu.org/software/autoconf/) installed.

<P>

<H3><A NAME="SECTION00033100000000000000"></A>
<A NAME="Sec:Libraries"></A>
<BR>
2.3.1 Libraries
</H3>

<P>
Q<SMALL>UANTUM </SMALL>ESPRESSO makes use of the following external libraries:

<UL>
<LI>BLAS (http://www.netlib.org/blas/) and 
</LI>
<LI>LAPACK (http://www.netlib.org/lapack/) for linear algebra 
</LI>
<LI>FFTW (http://www.fftw.org/) for Fast Fourier Transforms
</LI>
</UL>
A copy of the needed routines is provided with the distribution. However,
when available, optimized vendor-specific libraries can be used instead: this
often yields huge performance gains.

<P>

<H4><A NAME="SECTION00033110000000000000">
2.3.1.1 BLAS and LAPACK</A>
</H4> 
Q<SMALL>UANTUM </SMALL>ESPRESSO can use the following architecture-
specific replacements for BLAS and LAPACK:
<PRE>
      MKL for Intel Linux PCs
      ACML for AMD Linux PCs
      ESSL for IBM machines
      complib.sgimath for SGI Origin
      SCSL for SGI Altix
      SUNperf for Sun
      cxml for HP-Compaq Alphas.
</PRE>
If none of these is available, we suggest that you use the optimized ATLAS
library (http://math-atlas.sourceforge.net/). Note that ATLAS is not
a complete replacement for LAPACK: it contains all of the BLAS, plus the
LU code, plus the full storage Cholesky code. Follow the instructions in the
ATLAS distributions to produce a full LAPACK replacement.

<P>
Sergei Lisenkov reported success and good performances with optimized
BLAS by Kazushige Goto. They can be freely downloaded  (but not redistributed):
http://www.cs.utexas.edu/users/flame/goto/

<P>

<H4><A NAME="SECTION00033120000000000000">
2.3.1.2 FFT</A>
</H4>
Q<SMALL>UANTUM </SMALL>ESPRESSO can use the following vendor-specific FFT libraries:
<PRE>
      IBM ESSL
      SGI SCSL
      SUN sunperf
      NEC ASL
      AMD ACML
</PRE>
If none of the above is available, you should use FFTW, choosing
before compilation whether to load the built-in copy of FFTW 
or an external v.3 FFTW library.
<TT>configure</TT> will first search for vendor-specific FFT libraries;
if none is found, it will search for an external FFTW v.3 library;
if none is found, it will fall back to the internal  copy of FFTW.
Appropriate precompiling options will be set in all cases:
<PRE>
      __FFTW      internal FFTW
      __FFTW3     external FFTW v.3
      __SCSL      SGI SCSL
      __SUNPERF   SUN sunperf 
      __ESSL      IBM ESSL
        ASL       NEC ASL
</PRE>
If you have recent versions of MKL installed, you may try the 
FFTW interface provided with MKL. You will have to compile them
(they come in source form with the MKL library)
and to modify the make.sys accordingly (MKL must linked <EM>after</EM>
the FFTW-MKL interface)

<P>
If everything else fails, you'll have to modify the make.sys file
manually: see the section on Manual configuration. 

<P>

<H4><A NAME="SECTION00033130000000000000">
2.3.1.3 MPI libraries</A>
</H4> 
For parallel execution, Q<SMALL>UANTUM </SMALL>ESPRESSO uses the MPI libraries.
In well-configured machine, <TT>configure</TT> should find the appropriate
parallel compiler for you, and this should find the appropriate
libraries. Since often this doesn't 
happen, especially on PC clusters, see Sec.<A HREF="node13.html#Sec:LinuxPCMPI">2.6.6</A>.

<P>

<H4><A NAME="SECTION00033140000000000000">
2.3.1.4 Other libraries</A>
</H4>
Q<SMALL>UANTUM </SMALL>ESPRESSO can use the MASS vector math
library from IBM, if available (only on AIX).

<P>
The <TT>configure</TT> script attempts to find optimized libraries, but may fail
if they have been installed in non-standard places. You should examine
the final value of BLAS_LIBS, LAPACK_LIBS, FFT_LIBS, MPI_LIBS (if needed),
MASS_LIBS (IBM only), either in the output of <TT>configure</TT> or in the generated
make.sys, to check whether it found all the libraries that you intend to use.

<P>
If some library was not found, you can specify a list of directories to search
in the environment variable LIBDIRS, and rerun <TT>configure</TT>; directories in the
list must be separated by spaces. For example:
<PRE>
   ./configure LIBDIRS="/opt/intel/mkl70/lib/32 /usr/lib/math"
</PRE>
If this still fails, you may set some or all of the *_LIBS variables manually
and retry. For example:
<PRE>
   ./configure BLAS_LIBS="-L/usr/lib/math -lf77blas -latlas_sse"
</PRE>
Beware that in this case, <TT>configure</TT> will blindly accept the specified value,
and won't do any extra search. 

<P>
<EM>Please note</EM>: If you change any settings after a previous (successful or
failed) compilation, you must run <TT>make clean</TT> before recompiling, 
unless you
know exactly which routines are affected by the changed settings and how to
force their recompilation.

<P>

<H3><A NAME="SECTION00033200000000000000">
2.3.2 Manual configuration</A>
</H3>

<P>
If <TT>configure</TT> stops before the end, and you don't find a way to fix
it, you have to write working "make.sys", "include/fft_defs.h" and
"include/c_defs.h" files. 
For the latter two files, follow the explanations in 
"include/defs.h.README". 

<P>
If <TT>configure</TT> has run till the end, you should need only to
edit <TT>make.sys</TT>. A few templates (each for a different machine type)
are provided in the install/ directory: they have names of the
form <TT>Make.system</TT>, where "system" is a string identifying the 
architecture and compiler.

<P>
Obsolete: if you have the Intel compiler ifc v.6 or earlier, you will have to 
run the script <TT>./ifcmods.sh</TT>.

<P>
Most likely (and even more so if there isn't an exact match to your 
machine type), you'll have to tweak make.sys by hand. In particular, 
you must
specify the full list of libraries that you intend to link to.

<P>
<EM>NOTA BENE</EM>:
If you modify the program sources, run the
<TT>makedeps.sh</TT>  script  or type <TT>make depend</TT> 
to update files <TT>make.depend</TT> in the various 
subdirectories.

<P>
<HR>
<!--Navigation Panel-->
<A NAME="tex2html398"
  HREF="node11.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next" SRC="next.gif"></A> 
<A NAME="tex2html394"
  HREF="node7.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up" SRC="up.gif"></A> 
<A NAME="tex2html388"
  HREF="node9.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous" SRC="prev.gif"></A> 
<A NAME="tex2html396"
  HREF="node1.html">
<IMG WIDTH="65" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="contents" SRC="contents.gif"></A>  
<BR>
<B> Next:</B> <A NAME="tex2html399"
  HREF="node11.html">2.4 Compilation</A>
<B> Up:</B> <A NAME="tex2html395"
  HREF="node7.html">2 Installing QUANTUM ESPRESSO</A>
<B> Previous:</B> <A NAME="tex2html389"
  HREF="node9.html">2.2 Installation</A>
   <B>  <A NAME="tex2html397"
  HREF="node1.html">Contents</A></B> 
<!--End of Navigation Panel-->
<ADDRESS>
Paolo Giannozzi
2009-07-19
</ADDRESS>
</BODY>
</HTML>
